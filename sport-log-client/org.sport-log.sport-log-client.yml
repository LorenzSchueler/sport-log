app-id: org.sport_log.sport_log_client
runtime: org.freedesktop.Platform
runtime-version: '21.08'
sdk: org.freedesktop.Sdk
command: sport_log_client
finish-args:
  - --share=network # access the network
  - --socket=x11 # show windows using X11
  # - --socket=fallback-x11 # show windows using X11, if Wayland is not available
  - --socket=wayland # show windows with Wayland
  - --socket=pulseaudio # play sound with PulseAudio
  - --share=ipc # share IPC namespace with the host (necessary for X11)
  - --device=dri # OpenGL rendering
  - --filesystem=xdg-download
  - --filesystem=xdg-documents

modules:
  - name: sport-log-client
    buildsystem: simple
    only-arches: 
      - x86_64
      - aarch64
    build-commands:
      # copy bundle folder with executable and libs and data
      - mkdir -p /app/bin
      - cp -r bundle/* /app/bin/
      # link to libsqlite from freedesktop SDK
      - mkdir -p /app/lib
      - ln -s /usr/lib/x86_64-linux-gnu/libsqlite3.so.0 /app/lib/libsqlite3.so 
      - if [ ! -e '/app/lib/libsqlite3.so' ]; then ln -s -f /usr/lib/aarch64-linux-gnu/libsqlite3.so.0 /app/lib/libsqlite3.so; fi
      # copy .desktop and icon files
      # - install -Dm644 org.sport-log.sport-log-client.desktop /app/share/applications/org.sport-log.sport-log-client.desktop
      # - install -Dm644 org.sport-log.sport-log-client.metainfo.xml /app/share/metainfo/org.sport-log.sport-log-client.metainfo.xml
      # - install -Dm644 launcher_icon.png /app/share/icons/hicolor/1000x1000/apps/org.sport-log.sport-log-client.png
    sources:
      - type: dir
        path: build/linux/x64/debug/bundle
        dest: bundle
      # - type: file
        # path: org.sport-log.sport-log-client.desktop
      # - type: file
        # path: org.sport-log.sport-log-client.metainfo.xml
      # - type: file
        # path: launcher_icon.png

# flatpak-builder flatpak-build --force-clean org.sport-log.sport-log-client.yml

# flatpak-builder --user --install --force-clean flatpak-build org.sport-log.sport-log-client.yml
# flatpak run org.sport_log.sport_log_client

# flatpak-builder --force-clean --repo flatpak-repo flatpak-build org.sport-log.sport-log-client.yml